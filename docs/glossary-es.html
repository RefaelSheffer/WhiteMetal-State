<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Glosario â€“ SLV Monitor</title>
  <style>
    body { font-family: system-ui, Arial; margin: 0; background: #0b0f17; color: #e8eefc; line-height: 1.6; }
    .wrap { max-width: 1080px; margin: 0 auto; padding: 24px; }
    h1, h2 { color: #8bb2ff; }
    section { margin-bottom: 20px; background: #111a2b; border: 1px solid #1e2a45; border-radius: 12px; padding: 16px; }
    details { background: #0d1424; border: 1px solid #1e2a45; border-radius: 10px; padding: 10px 12px; margin: 10px 0; }
    summary { cursor: pointer; font-weight: 700; color: #e8eefc; }
    .muted { color: #a8b4d6; font-size: 14px; }
    a { color: #9cc2ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ“š Glosario (SLV Monitor)</h1>
    <p class="muted">Definiciones rÃ¡pidas de los tÃ©rminos y mÃ©tricas del panel, backtests y tooltips. Solo investigaciÃ³n; no es consejo financiero.</p>
    <div id="glossary"></div>
  </div>
  <script>
    const LANG = "es";
    const CATEGORY_TITLES = {
      "Probability Engine": { en: "Probability Engine", he: "×× ×•×¢ ×”×¡×ª×‘×¨×•×ª", es: "Motor de probabilidad" },
      "Performance & Backtest": { en: "Performance & Backtest", he: "×‘×™×¦×•×¢×™× ×•×‘×§×˜×¡×˜", es: "Rendimiento y backtest" },
      "Risk Management": { en: "Risk Management", he: "× ×™×”×•×œ ×¡×™×›×•× ×™×", es: "GestiÃ³n de riesgo" },
      "Positioning & Sentiment": { en: "Positioning & Sentiment", he: "×¤×•×–×™×¦×™×•×ª ×•×¡× ×˜×™×× ×˜", es: "Posicionamiento y sentimiento" },
      "Market Structure": { en: "Market Structure", he: "××‘× ×” ×©×•×§", es: "Estructura de mercado" },
      "Volatility": { en: "Volatility", he: "×ª× ×•×“×ª×™×•×ª", es: "Volatilidad" },
      "Recommendations": { en: "Recommendations", he: "×”××œ×¦×•×ª", es: "Recomendaciones" },
      "Charts & Context": { en: "Charts & Context", he: "×ª×¨×©×™××™× ×•×”×§×©×¨", es: "GrÃ¡ficos y contexto" }
    };

    function escapeHtml(str) {
      return (str || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function pickLang(obj) {
      if (!obj) return "";
      return obj[LANG] || obj.en || Object.values(obj)[0] || "";
    }

    function categoryName(cat) {
      const entry = CATEGORY_TITLES[cat];
      return entry ? pickLang(entry) : cat;
    }

    function renderGlossary(data) {
      const terms = Array.isArray(data?.terms) ? data.terms : [];
      const groups = new Map();
      terms.forEach((term) => {
        const cat = term.category || "Other";
        if (!groups.has(cat)) groups.set(cat, []);
        groups.get(cat).push(term);
      });

      const sortedCats = Array.from(groups.keys()).sort();
      const container = document.getElementById("glossary");
      container.innerHTML = sortedCats
        .map((cat) => {
          const items = groups.get(cat) || [];
          const details = items
            .sort((a, b) => pickLang(a.title).localeCompare(pickLang(b.title)))
            .map((term) => `
              <details id="${term.id}">
                <summary>${escapeHtml(pickLang(term.title) || term.id)}</summary>
                <div class="muted">${escapeHtml(pickLang(term.short))}</div>
                <p>${escapeHtml(pickLang(term.long))}</p>
              </details>
            `)
            .join("");
          return `<section><h2>${escapeHtml(categoryName(cat))}</h2>${details}</section>`;
        })
        .join("");
    }

    fetch("./glossary-data.json")
      .then((res) => res.json())
      .then((data) => renderGlossary(data))
      .catch((err) => {
        const container = document.getElementById("glossary");
        container.innerHTML = `<div class="muted">Error al cargar el glosario: ${escapeHtml(err?.message || err)}</div>`;
      });
  </script>
</body>
</html>
